[mcu]
canbus_uuid: 604243905c89
[include timelapse.cfg]                            # 延时摄影配置文件
#[include mmu/base/*.cfg]
#[include mmu/optional/client_macros.cfg]
[include configs/macros.cfg]                       # 宏脚本配置文件
#[include configs/ebb-canbus.cfg]
[include configs/SB_RP2350.cfg]                    # 打印头配置文件
[include configs/stealthburner_leds.cfg]           # StealthBurner灯效配置文件
#[include configs/pressure_advance.cfg]            # 压力提前配置文件
[include mainsail.cfg]                             # Mainsail网页界面配置文件
#[include code_macro.cfg]                          # XY轴润滑宏配置文件
#[include configs/fz-wipe-nozzle.cfg]              # 喷嘴擦拭宏配置文件
#[include configs/KNOMI.cfg]                       # KNOMI屏幕配置文件
[include configs/idm.cfg]                          # IDM配置文件
[include config_backup.cfg]                        # 配置备份文件
#[include configs/purge-trident.cfg]               # 清洁宏配置文件


[force_move]
enable_force_move: True
#   设置为true来启用 FORCE_MOVE 和 SET_KINEMATIC_POSITION 扩展 
#   G代码命令。
#   默认为false。

[respond]
default_type: echo
#   Sets the default prefix of the "M118" and "RESPOND" output to one
#   of the following:
#       echo: "echo: " (This is the default)
#       command: "// "
#       error: "!! "
default_prefix: echo:
#   Directly sets the default prefix. If present, this value will
#   override the "default_type".
#####################################################################
# 打印机基础配置
#####################################################################
[printer]
kinematics: corexy                                 # 打印机运动学类型：核心XY架构
max_velocity: 500                                  # 打印机最大移动速度限制（mm/s）
max_accel: 8000                                    # 最大加速度限制（mm/s²）
max_z_velocity: 15                                 # Z轴最大速度限制（mm/s），12V电源建议15，24V电源可适当提高
max_z_accel: 300                                   # Z轴加速度限制（mm/s²）
minimum_cruise_ratio: 0.5                          # 最低匀速运动距离比例，默认0.5表示匀速段占整个运动距离的一半
square_corner_velocity: 4.0                        # 打印拐角速度（mm/s）

[input_shaper]
#----------------桌子上-------------------
#shaper_type_x = 3hump_ei                          # X轴输入整形器类型：三峰EI
#shaper_freq_x = 115.6                             # X轴输入整形器频率（Hz）
#shaper_type_y = 3hump_ei                          # Y轴输入整形器类型：三峰EI
#shaper_freq_y = 55.2                              # Y轴输入整形器频率（Hz）

#----------------地上-------------------
# shaper_type_x = 2hump_ei                         # X轴输入整形器类型：双峰EI
# shaper_freq_x = 45.8                             # X轴输入整形器频率（Hz）
# shaper_type_y = 3hump_ei                         # Y轴输入整形器类型：三峰EI
# shaper_freq_y = 90.0                             # Y轴输入整形器频率（Hz）

#####################################################################
# X/Y 步进电机设置
#####################################################################
[stepper_x]
enable_pin: !PF1                                   # 使能引脚，!表示低电平有效
step_pin: PC13                                     # 步进脉冲引脚
dir_pin: PF0                                       # 方向控制引脚，加!可反转方向
microsteps: 1                                      # 微步设置，1表示使用手动设定的脉冲数
full_steps_per_rotation: 6400                      # 电机每转所需脉冲数，闭环步进建议6400，伺服建议16384
rotation_distance: 40                              # 丝杆每转的移动距离（mm）
position_endstop: 299                              # 归位开关位置（mm）
position_max: 299                                  # X轴最大行程（mm）
homing_speed: 100                                  # 归位速度（mm/s）
homing_retract_dist: 6                             # 归位后退距离（mm）
second_homing_speed: 20                            # 第二次归位速度（mm/s）
#step_pulse_duration:0.000000100                   # 伺服驱动器脉冲宽度设置
step_pulse_duration: 0.000001400                   # CL1驱动器脉冲宽度设置

[output_pin X_ALM-Clear]
pin: PE4                                           # 驱动报警清除引脚（UART接口）
value: 0                                           # MCU初始化时引脚默认值，0表示低电平

[filament_switch_sensor stepper_X_ALM]
pause_on_runout: true
#   当设置为 "True "时，会在检测到驱动报警后立即暂停打印机。
#   请注意, 如果 pause_on_runout 为 False 并且没有定义。
#   runout_gcode的话, 耗尽检测将被禁用。
#   默认为 True。
event_delay: 0.5
#事件之间的最小延迟时间（秒）。
#在这个时间段内触发的事件将被默许忽略。
#默认为3秒。
pause_delay: 0.5
#   暂停命令和执行 runout_gcode 之间的延迟时间, 单位是秒。
#   如果在OctoPrint的情况下，增加这个延迟可能改善暂
#   停的可靠性。如果OctoPrint表现出奇怪的暂停行为，
#   考虑增加这个延迟。
#   默认为0.5秒。
switch_pin: PG13
#   连接到检测开关的引脚。
#   此为驱动位DIAG引脚
#   必须提供此参数。

[stepper_y]
enable_pin: !PG2                                   # 使能引脚，!表示低电平有效
step_pin: PF9                                      # 步进脉冲引脚
dir_pin: PF10                                      # 方向控制引脚
microsteps: 1                                      # 微步设置
full_steps_per_rotation: 6400                      # 电机每转所需脉冲数
rotation_distance: 40                              # 丝杆每转的移动距离（mm）
endstop_pin: PG11                                  # 限位开关引脚
position_endstop: 299                              # 归位开关位置（mm）
position_max: 299                                  # Y轴最大行程（mm）
homing_speed: 100                                  # 归位速度（mm/s）
homing_retract_dist: 6                             # 归位后退距离（mm）
second_homing_speed: 20                            # 第二次归位速度（mm/s）
#step_pulse_duration:0.000000100                   # 伺服驱动器脉冲宽度设置
step_pulse_duration: 0.000001400                   # CL1驱动器脉冲宽度设置

[output_pin Y_ALM-Clear]
pin: PF2                                           # 驱动报警清除引脚（UART接口）
value: 0                                           # MCU初始化时引脚默认值

[filament_switch_sensor stepper_Y_ALM]
pause_on_runout: true
#   当设置为 "True "时，会在检测到驱动报警后立即暂停打印机。
#   请注意, 如果 pause_on_runout 为 False 并且没有定义。
#   runout_gcode的话, 耗尽检测将被禁用。
#   默认为 True。
event_delay: 0.5
#事件之间的最小延迟时间（秒）。
#在这个时间段内触发的事件将被默许忽略。
#默认为3秒。
pause_delay: 0.5
#   暂停命令和执行 runout_gcode 之间的延迟时间, 单位是秒。
#   如果在OctoPrint的情况下，增加这个延迟可能改善暂
#   停的可靠性。如果OctoPrint表现出奇怪的暂停行为，
#   考虑增加这个延迟。
#   默认为0.5秒。
switch_pin: PG12
#   连接到检测开关的引脚。
#   此为驱动位DIAG引脚

#####################################################################
# Z轴步进电机设置
#####################################################################
[stepper_z]
step_pin: PF13                                     # 步进脉冲引脚
dir_pin: PF12                                      # 方向控制引脚
enable_pin: !PF14                                  # 使能引脚
microsteps: 32                                     # 微步设置
endstop_pin: probe:z_virtual_endstop              # 使用探头作为虚拟Z限位
rotation_distance: 4                               # 丝杆每转移动距离，TR8x8=8，TR8x4=4，TR8x2=2
#position_endstop = 0.136                          # 限位开关触发点相对打印平面的Z位置（mm）
#position_endstop: 2.653                           # PEI板厚度0.52时的设置
#position_endstop: 2.703                           # 其他厚度设置
#position_endstop: 1.373                           # PEI板厚度0.60时的设置
#position_endstop: 1.923                           # 碳纤维板厚度1.10时的设置，值越大离热床越近
position_max: 240                                  # Z轴最大行程（mm）
position_min: -3.5                                 # Z轴最小行程（mm），可命令移动的最小距离
homing_speed: 5.0                                  # Z轴归位速度（mm/s）
second_homing_speed: 3.0                           # 第二次归位速度（mm/s），默认为homing_speed的一半
homing_retract_dist: 5.0                           # 归位过程中第二次归位前的后退距离（mm）

[tmc2209 stepper_z]
uart_pin: PC4                                      # UART通信引脚
interpolate: False                                 # 是否启用步进插值
                                                   # 为真时，驱动器会内部以256微步运行
                                                   # 仅当microsteps设置为16时有效，插值会引入微小系统位置偏差
                                                   # 默认为True
run_current: 0.65                                  # 运行电流（安培RMS）
hold_current: 0.3                                  # 保持电流（安培RMS）
stealthchop_threshold: 50                          # StealthChop模式的速度阈值（mm/s）
                                                   # 速度低于此值时启用静音模式
                                                   # 默认值为0，表示禁用StealthChop模式

[stepper_z1]
step_pin: PG0                                      # 步进脉冲引脚
dir_pin: PG1                                       # 方向控制引脚
enable_pin: !PF15                                  # 使能引脚
microsteps: 32                                     # 微步设置
rotation_distance: 4                               # 丝杆每转移动距离

[tmc2209 stepper_z1]
uart_pin: PD11                                     # UART通信引脚
interpolate: False                                 # 禁用插值
run_current: 1.0605                                # 运行电流（安培RMS）
hold_current: 0.3                                  # 保持电流（安培RMS）
stealthchop_threshold: 50                          # StealthChop速度阈值

[stepper_z2]
step_pin: PF11                                     # 步进脉冲引脚
dir_pin: PG3                                       # 方向控制引脚
enable_pin: !PG5                                   # 使能引脚
microsteps: 32                                     # 微步设置
rotation_distance: 4                               # 丝杆每转移动距离

[tmc2209 stepper_z2]
uart_pin: PC6                                      # UART通信引脚
interpolate: False                                 # 禁用插值
run_current: 1.0605                                # 运行电流（安培RMS）
hold_current: 0.3                                  # 保持电流（安培RMS）
stealthchop_threshold: 50                          # StealthChop速度阈值

#####################################################################
# 热床加热器配置
#####################################################################

[heater_bed]
heater_pin: PA1                                    # 热床加热器控制引脚
#sensor_type: ATC Semitec 104GT-2                  # 温度传感器类型
sensor_type: NTC 100K MGB18-104F39050L32           # 温度传感器类型
#sensor_type: PT1000                               # 温度传感器类型
sensor_pin: PF6                                    # 温度传感器引脚（Spider 3.x）
max_power: 0.8                                     # PWM最大输出功率（0-1）
min_temp: 10                                       # 热床最低温度（℃）
max_temp: 120                                      # 热床最高温度（℃）
#control: pid                                       # 控制方式：PID控制
#pid_Kp: 51.579                                     # PID比例系数
#pid_Ki: 2.149                                      # PID积分系数
#pid_Kd: 309.477                                    # PID微分系数

#####################################################################
# 无动作超时配置
#####################################################################
[idle_timeout]
timeout: 600                                       # 执行超时G代码前的等待时间（秒）
                                                   # 默认值为600秒（10分钟）
                                                   # 空闲超时时执行的G代码命令序列
                                                   # 默认执行 "TURN_OFF_HEATERS" 和 "M84"

#####################################################################
# 风扇控制配置
#####################################################################

[fan_generic 冷却风扇]
pin: PA3                                           # 冷却风扇控制引脚
max_power: 1.0                                     # 最大功率
off_below: 0.97                                    # 低于此功率值时完全关闭风扇

[fan_generic 电器仓1]
pin: PA8                                           # 电器仓风扇1控制引脚（FAN1 J52）
kick_start_time: 5                                 # 风扇启动前全速运行时间（秒）
max_power: 0.9                                     # 最大输出功率
off_below: 0.3                                     # 防止风扇失速的最小功率值

[delayed_gcode 电器仓1]
initial_duration: 1                                # 初始延迟时间（秒）
gcode:
    SET_FAN_SPEED FAN=电器仓1 SPEED=0.3            # 设置风扇速度为30%

[fan_generic 电器仓2]
pin: PE5                                           # 电器仓风扇2控制引脚（FAN1 J52）
kick_start_time: 5                                 # 风扇启动前全速运行时间（秒）
max_power: 0.9                                     # 最大输出功率
off_below: 0.3                                     # 防止风扇失速的最小功率值

[delayed_gcode NEVERMORE_OFF]
initial_duration: 1                                # 初始延迟时间（秒）
gcode:
    SET_FAN_SPEED FAN=电器仓2 SPEED=0.3            # 设置风扇速度为30%

[fan_generic 2209散热]
pin: PD12                                          # TMC2209散热风扇控制引脚（FAN1 J52）
kick_start_time: 5                                 # 风扇启动前全速运行时间（秒）
max_power: 0.9                                     # 最大输出功率
off_below: 0.3                                     # 防止风扇失速的最小功率值

[delayed_gcode 2209散热]
initial_duration: 1                                # 初始延迟时间（秒）
gcode:
    SET_FAN_SPEED FAN=2209散热 SPEED=0.5           # 设置风扇速度为50%

## 热床底部风扇 FAN2（已注释）
#[temperature_fan cycle_fan]
#pin: PD13                                          # 热床底部风扇控制引脚
#max_power: 0.7                                     # 最大功率
#shutdown_speed: 0.0                                # 关机时风扇速度
#kick_start_time: 0.500                             # 启动时间
#sensor_type: NTC 100K MGB18-104F39050L32           # 温度传感器类型
#sensor_pin: PF7                                    # 温度传感器引脚
#control: pid                                       # 控制方式：PID
#pid_Kp: 51.579                                     # PID比例系数
#pid_Ki: 2.149                                      # PID积分系数
#pid_Kd: 309.47                                     # PID微分系数
#min_temp: 0                                        # 最低温度
#max_temp: 80                                       # 最高温度
#target_temp: 0                                     # 目标温度

#####################################################################
# 照明灯配置
#####################################################################

## COB灯带（1米剪开分3条）
[led 仓内照明]
white_pin: PB11                                    # 白色LED控制引脚
initial_WHITE: 0.2                                 # 系统初始化后的亮度（0-1）
#hardware_pwm: true                                # 是否使用硬件PWM
cycle_time: 0.00002                                # PWM周期时间，频率=1/0.00002=50KHz

## 检查顶部照明是否开启，如果没开启则开启
[gcode_macro _CASELIGHT_ON]
description: 开启仓内照明灯
gcode:
    SET_LED LED=caselight WHITE=0.2                # 设置照明灯亮度为20%
    SET_NOZZLE_LEDS_ON                             # 开启喷嘴LED

## 延迟执行关闭顶部照明灯
[gcode_macro _CASELIGHT_OFF]
description: 关闭仓内照明灯
gcode:
    SET_LED LED=caselight WHITE=0.0                # 关闭照明灯
    SET_NOZZLE_LEDS_OFF                            # 关闭喷嘴LED

## 延迟关灯宏
[delayed_gcode CASELIGHT_DELAY_OFF]
gcode:
    _CASELIGHT_OFF                                 # 执行关灯命令

## 照明灯切换宏
[gcode_macro CASELIGHT]
description: 切换照明灯状态
gcode:
    {% if printer['led caselight'].color_data[0][3] == 0 %}  # 检查当前亮度是否为0
        _CASELIGHT_ON                               # 如果关闭则开启
    {% else %}
        _CASELIGHT_OFF                              # 如果开启则关闭
    {% endif %}

#####################################################################
# 温度传感器配置
#####################################################################

## 仓内温度传感器（已注释）
#[temperature_sensor 仓温]
#sensor_type: Generic 3950                          # 温度传感器类型：3950热敏电阻
#sensor_pin: PF7                                    # 温度传感器引脚
#min_temp: 0                                        # 最低温度
#max_temp: 100                                      # 最高温度

#####################################################################
# 步进电机测试宏
#####################################################################

[gcode_macro TEST_STEPPER_B]
description: 测试X轴（左）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_x                 # 执行步进电机蜂鸣测试
    { action_respond_info('左电机将先顺时针旋转，然后逆时针旋转') }  # 返回提示信息

[gcode_macro TEST_STEPPER_A]
description: 测试Y轴（右）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_y                 # 执行步进电机蜂鸣测试
    { action_respond_info('右电机将先顺时针旋转，然后逆时针旋转') }  # 返回提示信息

[gcode_macro TEST_STEPPER_Z]
description: 测试Z轴（左前）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_z                 # 执行步进电机蜂鸣测试
    { action_respond_info('（左前Z）床的左侧向下移动，然后又向上移动') }  # 返回提示信息

[gcode_macro TEST_STEPPER_Z1]
description: 测试Z1轴（后中）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_z1                # 执行步进电机蜂鸣测试
    { action_respond_info('（后中Z）床的后方向下移动，然后又向上移动') }  # 返回提示信息

[gcode_macro TEST_STEPPER_Z2]
description: 测试Z2轴（右前）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_z2                # 执行步进电机蜂鸣测试
    { action_respond_info('（右前Z）床的右侧向下移动，然后又向上移动') }  # 返回提示信息

#####################################################################
# 其他配置
#####################################################################

## 过滤风扇配置（已注释）
#[fan_generic 过滤]
#pin: PA8                                           # 过滤风扇控制引脚（fan0 J50）
#max_power: 1                                       # 最大功率
#shutdown_speed: 1                                  # 关机时速度
#cycle_time: 0.010                                  # 周期时间
#kick_start_time: 0.100                             # 启动时间
#off_below: 0.0                                     # 关闭阈值

## 电机参数配置（已注释）
######[motor_constants ls-42CM06]
#####resistance: 0.9                                # 电机电阻（Ω）
####inductance: 0.0016                             # 电机电感（H）
###holding_torque: 0.6                             # 保持扭矩（Nm）
##max_current: 2.5                                 # 最大电流（A）
#steps_per_revolution: 200                        # 每转步数（1.8度=200步）

## 打印完成后关机配置（已注释）
##########[output_pin ps_on]
#########pin: PE11                                  # 电源控制引脚
########value: 1                                     # 初始值（高电平）
#######shutdown_value: 0                             # 关机时值（低电平）
######[gcode_macro m80]
#####gcode:
####  SET_PIN PIN=ps_on VALUE=1                      # 开机命令，拉高电平
# 关机命令，拉低电平
###[gcode_macro m81]
##gcode:
#  SET_PIN PIN=ps_on VALUE=0                        # 关机命令，拉低电平

#####################################################################
# SAVE_CONFIG 自动生成部分 - 请勿手动编辑
#####################################################################

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 88.4
#*# shaper_type_y = 3hump_ei
#*# shaper_freq_y = 74.4
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 51.607
#*# pid_ki = 2.309
#*# pid_kd = 288.357
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.047531, -0.014081, -0.023874, -0.047853, -0.053113, -0.049270, -0.045375, -0.045747, -0.047665, -0.044755, -0.047038, -0.051362, -0.052104, -0.039208, -0.024523
#*# 	-0.038556, -0.010074, -0.002881, -0.029268, -0.040082, -0.035196, -0.030713, -0.032491, -0.032435, -0.030993, -0.033691, -0.036997, -0.038058, -0.026710, -0.014649
#*# 	-0.034010, -0.015806, 0.016626, 0.003778, -0.021527, -0.020901, -0.015115, -0.016677, -0.016997, -0.013834, -0.018740, -0.021842, -0.023183, -0.015270, -0.004939
#*# 	-0.032084, -0.015425, 0.021594, 0.028266, -0.004333, -0.015187, -0.013103, -0.013720, -0.014254, -0.011981, -0.017505, -0.019675, -0.021119, -0.011800, -0.004302
#*# 	-0.024778, -0.014783, 0.012969, 0.048791, 0.032581, 0.002701, -0.006255, -0.006098, -0.004059, -0.001427, -0.011381, -0.013802, -0.014637, -0.008301, 0.001225
#*# 	-0.016081, -0.008148, 0.011542, 0.052028, 0.060594, 0.022468, 0.000474, -0.000033, 0.003448, 0.002826, -0.008566, -0.013103, -0.015466, -0.003973, 0.002677
#*# 	-0.014420, -0.009206, 0.001010, 0.031583, 0.067614, 0.049891, 0.008631, -0.002035, 0.001525, 0.003312, -0.007123, -0.014076, -0.017805, -0.007690, 0.003013
#*# 	-0.010546, -0.005615, 0.003756, 0.020989, 0.063659, 0.069400, 0.025389, 0.003528, 0.001125, 0.001173, -0.009186, -0.014112, -0.018179, -0.009435, -0.004951
#*# 	-0.015965, -0.013586, -0.003307, 0.001461, 0.029983, 0.074986, 0.058718, 0.020431, -0.001702, -0.008672, -0.017591, -0.024129, -0.027163, -0.021480, -0.018364
#*# 	-0.022714, -0.018942, -0.008251, -0.006603, 0.008478, 0.061202, 0.074794, 0.052224, 0.013760, -0.010612, -0.020049, -0.024222, -0.026642, -0.022943, -0.022235
#*# 	-0.041264, -0.034234, -0.025894, -0.022199, -0.021044, 0.008802, 0.044745, 0.061417, 0.032967, -0.011333, -0.027933, -0.034906, -0.038829, -0.035604, -0.035654
#*# 	-0.056375, -0.048906, -0.040522, -0.034038, -0.033268, -0.018081, 0.012142, 0.048370, 0.032260, -0.015929, -0.035541, -0.043193, -0.050245, -0.046345, -0.046576
#*# 	-0.077165, -0.066497, -0.046458, -0.046740, -0.047613, -0.043448, -0.028785, 0.010800, 0.016410, -0.018303, -0.044847, -0.055429, -0.060283, -0.059960, -0.060749
#*# 	-0.096195, -0.084451, -0.063987, -0.064774, -0.063210, -0.059626, -0.052051, -0.026019, -0.001796, -0.017740, -0.055940, -0.070320, -0.064668, -0.071908, -0.077600
#*# 	-0.107053, -0.095582, -0.084136, -0.081977, -0.076183, -0.067486, -0.058461, -0.041269, -0.020010, -0.022453, -0.060841, -0.079672, -0.085380, -0.087604, -0.091839
#*# tension = 0.2
#*# min_x = 20.0
#*# algo = bicubic
#*# y_count = 15
#*# mesh_y_pps = 2
#*# min_y = 25.0
#*# x_count = 15
#*# max_y = 270.0
#*# mesh_x_pps = 2
#*# max_x = 270.0
#*#
#*# [scanner model default]
#*# model_coef = 1.2549836299069017,
#*# 	1.679209122022639,
#*# 	0.7630331675499646,
#*# 	0.3322383441972025,
#*# 	0.4496421275471343,
#*# 	0.631661885826226,
#*# 	-0.29157456862970466,
#*# 	-0.613003988473124,
#*# 	0.373054383611033,
#*# 	0.421583153172411
#*# model_domain = 3.1043350681846773e-07,3.3527604172942645e-07
#*# model_range = 0.100208,5.000208
#*# model_temp = 23.527517
#*# model_offset = -0.021
#*#
#*# [scanner]
#*# scanner_touch_threshold = 4500
#*# z_offset = 0.325
