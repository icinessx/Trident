[mcu]
canbus_uuid: 604243905c89
[include timelapse.cfg]                            # 延时摄影配置文件
#[include mmu/base/*.cfg]
#[include mmu/optional/client_macros.cfg]
[include configs/macros.cfg]                       # 宏脚本配置文件
#[include configs/ebb-canbus.cfg]
[include configs/SB_RP2350.cfg]                    # 打印头配置文件
[include configs/stealthburner_leds.cfg]           # StealthBurner灯效配置文件
#[include configs/pressure_advance.cfg]            # 压力提前配置文件
[include mainsail.cfg]                             # Mainsail网页界面配置文件
#[include code_macro.cfg]                          # XY轴润滑宏配置文件
#[include configs/fz-wipe-nozzle.cfg]              # 喷嘴擦拭宏配置文件
#[include configs/KNOMI.cfg]                       # KNOMI屏幕配置文件
[include configs/idm.cfg]                          # IDM配置文件
[include config_backup.cfg]                        # 配置备份文件
#[include configs/purge-trident.cfg]               # 清洁宏配置文件

#[auto_speed]

[force_move]
enable_force_move: True
#   设置为true来启用 FORCE_MOVE 和 SET_KINEMATIC_POSITION 扩展 
#   G代码命令。
#   默认为false。

[respond]
default_type: echo
#   Sets the default prefix of the "M118" and "RESPOND" output to one
#   of the following:
#       echo: "echo: " (This is the default)
#       command: "// "
#       error: "!! "
default_prefix: echo:
#   Directly sets the default prefix. If present, this value will
#   override the "default_type".
#####################################################################
# 打印机基础配置
#####################################################################
[printer]
kinematics: corexy                                 # 打印机运动学类型：核心XY架构
max_velocity: 500                                  # 打印机最大移动速度限制（mm/s）
max_accel: 8000                                    # 最大加速度限制（mm/s²）
max_z_velocity: 15                                 # Z轴最大速度限制（mm/s），12V电源建议15，24V电源可适当提高
max_z_accel: 300                                   # Z轴加速度限制（mm/s²）
minimum_cruise_ratio: 0.5                          # 最低匀速运动距离比例，默认0.5表示匀速段占整个运动距离的一半
square_corner_velocity: 4.0                        # 打印拐角速度（mm/s）

[input_shaper]
#----------------桌子上-------------------
#shaper_type_x = 3hump_ei                          # X轴输入整形器类型：三峰EI
#shaper_freq_x = 115.6                             # X轴输入整形器频率（Hz）
#shaper_type_y = 3hump_ei                          # Y轴输入整形器类型：三峰EI
#shaper_freq_y = 55.2                              # Y轴输入整形器频率（Hz）

#----------------地上-------------------
# shaper_type_x = 2hump_ei                         # X轴输入整形器类型：双峰EI
# shaper_freq_x = 45.8                             # X轴输入整形器频率（Hz）
# shaper_type_y = 3hump_ei                         # Y轴输入整形器类型：三峰EI
# shaper_freq_y = 90.0                             # Y轴输入整形器频率（Hz）

#####################################################################
# X/Y 步进电机设置
#####################################################################
[stepper_x]
enable_pin: !PF1                                   # 使能引脚，!表示低电平有效
step_pin: PC13                                     # 步进脉冲引脚
dir_pin: PF0                                       # 方向控制引脚，加!可反转方向
microsteps: 1                                      # 微步设置，1表示使用手动设定的脉冲数
full_steps_per_rotation: 6400                      # 电机每转所需脉冲数，闭环步进建议6400，伺服建议16384
rotation_distance: 40                              # 丝杆每转的移动距离（mm）
position_endstop: 299                              # 归位开关位置（mm）
position_max: 299                                  # X轴最大行程（mm）
homing_speed: 100                                  # 归位速度（mm/s）
homing_retract_dist: 6                             # 归位后退距离（mm）
second_homing_speed: 20                            # 第二次归位速度（mm/s）
#step_pulse_duration:0.000000100                   # 伺服驱动器脉冲宽度设置
step_pulse_duration: 0.000001400                   # CL1驱动器脉冲宽度设置

[output_pin X_ALM-Clear]
pin: PE4                                           # 驱动报警清除引脚（UART接口）
value: 0                                           # MCU初始化时引脚默认值，0表示低电平

[filament_switch_sensor stepper_X_ALM]
pause_on_runout: true
#   当设置为 "True "时，会在检测到驱动报警后立即暂停打印机。
#   请注意, 如果 pause_on_runout 为 False 并且没有定义。
#   runout_gcode的话, 耗尽检测将被禁用。
#   默认为 True。
event_delay: 0.5
#事件之间的最小延迟时间（秒）。
#在这个时间段内触发的事件将被默许忽略。
#默认为3秒。
pause_delay: 0.5
#   暂停命令和执行 runout_gcode 之间的延迟时间, 单位是秒。
#   如果在OctoPrint的情况下，增加这个延迟可能改善暂
#   停的可靠性。如果OctoPrint表现出奇怪的暂停行为，
#   考虑增加这个延迟。
#   默认为0.5秒。
switch_pin: PG13
#   连接到检测开关的引脚。
#   此为驱动位DIAG引脚
#   必须提供此参数。

[stepper_y]
enable_pin: !PG2                                   # 使能引脚，!表示低电平有效
step_pin: PF9                                      # 步进脉冲引脚
dir_pin: PF10                                      # 方向控制引脚
microsteps: 1                                      # 微步设置
full_steps_per_rotation: 6400                      # 电机每转所需脉冲数
rotation_distance: 40                              # 丝杆每转的移动距离（mm）
endstop_pin: PG11                                  # 限位开关引脚
position_endstop: 299                              # 归位开关位置（mm）
position_max: 299                                  # Y轴最大行程（mm）
homing_speed: 100                                  # 归位速度（mm/s）
homing_retract_dist: 6                             # 归位后退距离（mm）
second_homing_speed: 20                            # 第二次归位速度（mm/s）
#step_pulse_duration:0.000000100                   # 伺服驱动器脉冲宽度设置
step_pulse_duration: 0.000001400                   # CL1驱动器脉冲宽度设置

[output_pin Y_ALM-Clear]
pin: PF2                                           # 驱动报警清除引脚（UART接口）
value: 0                                           # MCU初始化时引脚默认值

[filament_switch_sensor stepper_Y_ALM]
pause_on_runout: true
#   当设置为 "True "时，会在检测到驱动报警后立即暂停打印机。
#   请注意, 如果 pause_on_runout 为 False 并且没有定义。
#   runout_gcode的话, 耗尽检测将被禁用。
#   默认为 True。
event_delay: 0.5
#事件之间的最小延迟时间（秒）。
#在这个时间段内触发的事件将被默许忽略。
#默认为3秒。
pause_delay: 0.5
#   暂停命令和执行 runout_gcode 之间的延迟时间, 单位是秒。
#   如果在OctoPrint的情况下，增加这个延迟可能改善暂
#   停的可靠性。如果OctoPrint表现出奇怪的暂停行为，
#   考虑增加这个延迟。
#   默认为0.5秒。
switch_pin: PG12
#   连接到检测开关的引脚。
#   此为驱动位DIAG引脚

#####################################################################
# Z轴步进电机设置
#####################################################################
[stepper_z]
step_pin: PF13                                     # 步进脉冲引脚
dir_pin: PF12                                      # 方向控制引脚
enable_pin: !PF14                                  # 使能引脚
microsteps: 32                                     # 微步设置
endstop_pin: probe:z_virtual_endstop              # 使用探头作为虚拟Z限位
rotation_distance: 4                               # 丝杆每转移动距离，TR8x8=8，TR8x4=4，TR8x2=2
#position_endstop = 0.136                          # 限位开关触发点相对打印平面的Z位置（mm）
#position_endstop: 2.653                           # PEI板厚度0.52时的设置
#position_endstop: 2.703                           # 其他厚度设置
#position_endstop: 1.373                           # PEI板厚度0.60时的设置
#position_endstop: 1.923                           # 碳纤维板厚度1.10时的设置，值越大离热床越近
position_max: 240                                  # Z轴最大行程（mm）
position_min: -3.5                                 # Z轴最小行程（mm），可命令移动的最小距离
homing_speed: 5.0                                  # Z轴归位速度（mm/s）
second_homing_speed: 3.0                           # 第二次归位速度（mm/s），默认为homing_speed的一半
homing_retract_dist: 5.0                           # 归位过程中第二次归位前的后退距离（mm）

[tmc2209 stepper_z]
uart_pin: PC4                                      # UART通信引脚
interpolate: False                                 # 是否启用步进插值
                                                   # 为真时，驱动器会内部以256微步运行
                                                   # 仅当microsteps设置为16时有效，插值会引入微小系统位置偏差
                                                   # 默认为True
run_current: 0.65                                  # 运行电流（安培RMS）
hold_current: 0.3                                  # 保持电流（安培RMS）
stealthchop_threshold: 50                          # StealthChop模式的速度阈值（mm/s）
                                                   # 速度低于此值时启用静音模式
                                                   # 默认值为0，表示禁用StealthChop模式

[stepper_z1]
step_pin: PG0                                      # 步进脉冲引脚
dir_pin: PG1                                       # 方向控制引脚
enable_pin: !PF15                                  # 使能引脚
microsteps: 32                                     # 微步设置
rotation_distance: 4                               # 丝杆每转移动距离

[tmc2209 stepper_z1]
uart_pin: PD11                                     # UART通信引脚
interpolate: False                                 # 禁用插值
run_current: 1.0605                                # 运行电流（安培RMS）
hold_current: 0.3                                  # 保持电流（安培RMS）
stealthchop_threshold: 50                          # StealthChop速度阈值

[stepper_z2]
step_pin: PF11                                     # 步进脉冲引脚
dir_pin: PG3                                       # 方向控制引脚
enable_pin: !PG5                                   # 使能引脚
microsteps: 32                                     # 微步设置
rotation_distance: 4                               # 丝杆每转移动距离

[tmc2209 stepper_z2]
uart_pin: PC6                                      # UART通信引脚
interpolate: False                                 # 禁用插值
run_current: 1.0605                                # 运行电流（安培RMS）
hold_current: 0.3                                  # 保持电流（安培RMS）
stealthchop_threshold: 50                          # StealthChop速度阈值

#####################################################################
# 热床加热器配置
#####################################################################

[heater_bed]
heater_pin: PA1                                    # 热床加热器控制引脚
#sensor_type: ATC Semitec 104GT-2                  # 温度传感器类型
sensor_type: NTC 100K MGB18-104F39050L32           # 温度传感器类型
#sensor_type: PT1000                               # 温度传感器类型
sensor_pin: PF6                                    # 温度传感器引脚（Spider 3.x）
max_power: 0.8                                     # PWM最大输出功率（0-1）
min_temp: 10                                       # 热床最低温度（℃）
max_temp: 120                                      # 热床最高温度（℃）
control: pid                                       # 控制方式：PID控制
pid_Kp: 51.579                                     # PID比例系数
pid_Ki: 2.149                                      # PID积分系数
pid_Kd: 309.477                                    # PID微分系数

#####################################################################
# 无动作超时配置
#####################################################################
[idle_timeout]
timeout: 600                                       # 执行超时G代码前的等待时间（秒）
                                                   # 默认值为600秒（10分钟）
                                                   # 空闲超时时执行的G代码命令序列
                                                   # 默认执行 "TURN_OFF_HEATERS" 和 "M84"

#####################################################################
# 风扇控制配置
#####################################################################

[fan_generic 冷却风扇]
pin: PA3                                           # 冷却风扇控制引脚
max_power: 1.0                                     # 最大功率
off_below: 0.97                                    # 低于此功率值时完全关闭风扇

[fan_generic 电器仓1]
pin: PA8                                           # 电器仓风扇1控制引脚（FAN1 J52）
kick_start_time: 5                                 # 风扇启动前全速运行时间（秒）
max_power: 0.9                                     # 最大输出功率
off_below: 0.3                                     # 防止风扇失速的最小功率值

[delayed_gcode 电器仓1]
initial_duration: 1                                # 初始延迟时间（秒）
gcode:
    SET_FAN_SPEED FAN=电器仓1 SPEED=0.3            # 设置风扇速度为30%

[fan_generic 电器仓2]
pin: PE5                                           # 电器仓风扇2控制引脚（FAN1 J52）
kick_start_time: 5                                 # 风扇启动前全速运行时间（秒）
max_power: 0.9                                     # 最大输出功率
off_below: 0.3                                     # 防止风扇失速的最小功率值

[delayed_gcode NEVERMORE_OFF]
initial_duration: 1                                # 初始延迟时间（秒）
gcode:
    SET_FAN_SPEED FAN=电器仓2 SPEED=0.3            # 设置风扇速度为30%

[fan_generic 2209散热]
pin: PD12                                          # TMC2209散热风扇控制引脚（FAN1 J52）
kick_start_time: 5                                 # 风扇启动前全速运行时间（秒）
max_power: 0.9                                     # 最大输出功率
off_below: 0.3                                     # 防止风扇失速的最小功率值

[delayed_gcode 2209散热]
initial_duration: 1                                # 初始延迟时间（秒）
gcode:
    SET_FAN_SPEED FAN=2209散热 SPEED=0.5           # 设置风扇速度为50%

## 热床底部风扇 FAN2（已注释）
#[temperature_fan cycle_fan]
#pin: PD13                                          # 热床底部风扇控制引脚
#max_power: 0.7                                     # 最大功率
#shutdown_speed: 0.0                                # 关机时风扇速度
#kick_start_time: 0.500                             # 启动时间
#sensor_type: NTC 100K MGB18-104F39050L32           # 温度传感器类型
#sensor_pin: PF7                                    # 温度传感器引脚
#control: pid                                       # 控制方式：PID
#pid_Kp: 51.579                                     # PID比例系数
#pid_Ki: 2.149                                      # PID积分系数
#pid_Kd: 309.47                                     # PID微分系数
#min_temp: 0                                        # 最低温度
#max_temp: 80                                       # 最高温度
#target_temp: 0                                     # 目标温度

#####################################################################
# 照明灯配置
#####################################################################

## COB灯带（1米剪开分3条）
[led 仓内照明]
white_pin: PB11                                    # 白色LED控制引脚
initial_WHITE: 0.2                                 # 系统初始化后的亮度（0-1）
#hardware_pwm: true                                # 是否使用硬件PWM
cycle_time: 0.00002                                # PWM周期时间，频率=1/0.00002=50KHz

## 检查顶部照明是否开启，如果没开启则开启
[gcode_macro _CASELIGHT_ON]
description: 开启仓内照明灯
gcode:
    SET_LED LED=caselight WHITE=0.2                # 设置照明灯亮度为20%
    SET_NOZZLE_LEDS_ON                             # 开启喷嘴LED

## 延迟执行关闭顶部照明灯
[gcode_macro _CASELIGHT_OFF]
description: 关闭仓内照明灯
gcode:
    SET_LED LED=caselight WHITE=0.0                # 关闭照明灯
    SET_NOZZLE_LEDS_OFF                            # 关闭喷嘴LED

## 延迟关灯宏
[delayed_gcode CASELIGHT_DELAY_OFF]
gcode:
    _CASELIGHT_OFF                                 # 执行关灯命令

## 照明灯切换宏
[gcode_macro CASELIGHT]
description: 切换照明灯状态
gcode:
    {% if printer['led caselight'].color_data[0][3] == 0 %}  # 检查当前亮度是否为0
        _CASELIGHT_ON                               # 如果关闭则开启
    {% else %}
        _CASELIGHT_OFF                              # 如果开启则关闭
    {% endif %}

#####################################################################
# 温度传感器配置
#####################################################################

## 仓内温度传感器（已注释）
#[temperature_sensor 仓温]
#sensor_type: Generic 3950                          # 温度传感器类型：3950热敏电阻
#sensor_pin: PF7                                    # 温度传感器引脚
#min_temp: 0                                        # 最低温度
#max_temp: 100                                      # 最高温度

#####################################################################
# 步进电机测试宏
#####################################################################

[gcode_macro TEST_STEPPER_B]
description: 测试X轴（左）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_x                 # 执行步进电机蜂鸣测试
    { action_respond_info('左电机将先顺时针旋转，然后逆时针旋转') }  # 返回提示信息

[gcode_macro TEST_STEPPER_A]
description: 测试Y轴（右）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_y                 # 执行步进电机蜂鸣测试
    { action_respond_info('右电机将先顺时针旋转，然后逆时针旋转') }  # 返回提示信息

[gcode_macro TEST_STEPPER_Z]
description: 测试Z轴（左前）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_z                 # 执行步进电机蜂鸣测试
    { action_respond_info('（左前Z）床的左侧向下移动，然后又向上移动') }  # 返回提示信息

[gcode_macro TEST_STEPPER_Z1]
description: 测试Z1轴（后中）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_z1                # 执行步进电机蜂鸣测试
    { action_respond_info('（后中Z）床的后方向下移动，然后又向上移动') }  # 返回提示信息

[gcode_macro TEST_STEPPER_Z2]
description: 测试Z2轴（右前）步进电机
gcode:
    STEPPER_BUZZ STEPPER=stepper_z2                # 执行步进电机蜂鸣测试
    { action_respond_info('（右前Z）床的右侧向下移动，然后又向上移动') }  # 返回提示信息

#####################################################################
# 其他配置
#####################################################################

## 过滤风扇配置（已注释）
#[fan_generic 过滤]
#pin: PA8                                           # 过滤风扇控制引脚（fan0 J50）
#max_power: 1                                       # 最大功率
#shutdown_speed: 1                                  # 关机时速度
#cycle_time: 0.010                                  # 周期时间
#kick_start_time: 0.100                             # 启动时间
#off_below: 0.0                                     # 关闭阈值

## 电机参数配置（已注释）
######[motor_constants ls-42CM06]
#####resistance: 0.9                                # 电机电阻（Ω）
####inductance: 0.0016                             # 电机电感（H）
###holding_torque: 0.6                             # 保持扭矩（Nm）
##max_current: 2.5                                 # 最大电流（A）
#steps_per_revolution: 200                        # 每转步数（1.8度=200步）

## 打印完成后关机配置（已注释）
##########[output_pin ps_on]
#########pin: PE11                                  # 电源控制引脚
########value: 1                                     # 初始值（高电平）
#######shutdown_value: 0                             # 关机时值（低电平）
######[gcode_macro m80]
#####gcode:
####  SET_PIN PIN=ps_on VALUE=1                      # 开机命令，拉高电平
# 关机命令，拉低电平
###[gcode_macro m81]
##gcode:
#  SET_PIN PIN=ps_on VALUE=0                        # 关机命令，拉低电平

#####################################################################
# SAVE_CONFIG 自动生成部分 - 请勿手动编辑
#####################################################################

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 88.4
#*# shaper_type_y = 3hump_ei
#*# shaper_freq_y = 74.4
#*#
#*# [heater_bed]
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.031049, -0.022705, -0.020754, -0.022810, -0.027085, -0.027969, -0.026084, -0.026870, -0.034034, -0.034889, -0.037403, -0.044959, -0.048953, -0.040770, -0.030641
#*# 	-0.019295, -0.017849, -0.016341, -0.017596, -0.021189, -0.019725, -0.020312, -0.022967, -0.024949, -0.026745, -0.031525, -0.034085, -0.038941, -0.030498, -0.020391
#*# 	-0.010115, -0.006709, -0.002795, -0.004620, -0.008032, -0.006231, -0.007515, -0.009966, -0.013333, -0.012423, -0.018802, -0.023440, -0.027904, -0.023221, -0.015159
#*# 	-0.007108, -0.002160, 0.001385, -0.002859, -0.005505, -0.004907, -0.006106, -0.009012, -0.011684, -0.012765, -0.018902, -0.022603, -0.026135, -0.019469, -0.016525
#*# 	-0.001328, 0.005748, 0.009003, 0.006625, 0.001599, 0.000571, -0.002831, -0.005265, -0.006545, -0.006777, -0.017551, -0.021501, -0.023956, -0.021249, -0.014178
#*# 	0.007661, 0.013132, 0.016348, 0.015981, 0.012788, 0.008231, 0.003305, 0.000724, -0.000576, -0.002588, -0.015870, -0.021475, -0.024949, -0.019918, -0.010573
#*# 	0.011142, 0.012820, 0.018700, 0.017347, 0.011233, 0.010632, 0.006573, -0.000898, -0.002711, -0.003603, -0.016231, -0.023984, -0.031656, -0.025838, -0.017293
#*# 	0.016607, 0.019455, 0.022298, 0.021734, 0.014310, 0.014019, 0.010750, 0.002787, -0.000923, -0.005697, -0.017586, -0.024579, -0.029868, -0.024852, -0.023669
#*# 	0.016101, 0.013708, 0.018434, 0.017470, 0.012416, 0.010885, 0.006733, -0.001140, -0.008167, -0.013445, -0.024291, -0.031765, -0.037932, -0.035294, -0.035103
#*# 	0.012430, 0.012268, 0.016792, 0.015202, 0.008377, 0.007176, 0.004593, -0.001681, -0.007787, -0.012196, -0.024678, -0.032666, -0.037322, -0.036196, -0.036575
#*# 	-0.002291, -0.000507, 0.004849, 0.006145, -0.002505, -0.002996, -0.007764, -0.011051, -0.018216, -0.019291, -0.029917, -0.040208, -0.047598, -0.046972, -0.049932
#*# 	-0.011860, -0.009702, -0.006606, -0.004142, -0.007424, -0.006534, -0.013551, -0.014967, -0.020000, -0.024050, -0.033438, -0.044677, -0.054578, -0.054536, -0.057723
#*# 	-0.023395, -0.021619, -0.015435, -0.012799, -0.014776, -0.016101, -0.019940, -0.021827, -0.024487, -0.029501, -0.040214, -0.053786, -0.063017, -0.061663, -0.067101
#*# 	-0.037382, -0.035042, -0.027300, -0.023583, -0.025450, -0.026813, -0.028603, -0.030490, -0.032767, -0.038299, -0.050800, -0.066266, -0.074588, -0.072731, -0.080168
#*# 	-0.043291, -0.035014, -0.029906, -0.032797, -0.033679, -0.031283, -0.030133, -0.034739, -0.038599, -0.044573, -0.056762, -0.071003, -0.082895, -0.087123, -0.090118
#*# tension = 0.2
#*# min_x = 20.0
#*# algo = bicubic
#*# y_count = 15
#*# mesh_y_pps = 2
#*# min_y = 25.0
#*# x_count = 15
#*# max_y = 270.0
#*# mesh_x_pps = 2
#*# max_x = 270.0
#*#
#*# [scanner model default]
#*# model_coef = 1.2549836299069017,
#*# 	1.679209122022639,
#*# 	0.7630331675499646,
#*# 	0.3322383441972025,
#*# 	0.4496421275471343,
#*# 	0.631661885826226,
#*# 	-0.29157456862970466,
#*# 	-0.613003988473124,
#*# 	0.373054383611033,
#*# 	0.421583153172411
#*# model_domain = 3.1043350681846773e-07,3.3527604172942645e-07
#*# model_range = 0.100208,5.000208
#*# model_temp = 23.527517
#*# model_offset = -0.191
#*#
#*# [scanner]
#*# scanner_touch_threshold = 4500
#*# z_offset = 0.200
